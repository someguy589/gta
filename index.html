<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Home Alone: Monster Escape</title>
<style>
body { margin:0; overflow:hidden; background:#111; }
canvas { display:block; }
#hud {
    position:fixed; top:10px; left:10px;
    color:white; font-family:Arial;
    background:rgba(0,0,0,0.6); padding:8px;
}
</style>
</head>
<body>
<div id="hud">
‚ù§Ô∏è Health: <span id="hp">100</span><br>
üîë Keys: <span id="keys">0</span>/4<br>
üö™ Doors: <span id="doors">Closed</span>
</div>
<canvas id="game"></canvas>

<script>
// ----- CANVAS -----
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

// ----- PLAYER -----
const player = {
    x: 200, y: 1400,
    angle:0,
    speed:3,
    health:100,
    keysCollected:0,
    inSafeZone:true
};

// ----- INPUT -----
const keys = {};
addEventListener("keydown", e => keys[e.key.toLowerCase()]=true);
addEventListener("keyup", e => keys[e.key.toLowerCase()]=false);
let mouseX=0, mouseY=0;
addEventListener("mousemove", e=>{mouseX=e.clientX; mouseY=e.clientY});

// ----- SOUND -----
const growl = new Audio('https://www.soundjay.com/horror/monster-growl-1.mp3'); // monster growl
growl.volume=0.3;

// ----- WORLD -----
const world = { w: 2000, h: 1600 };

// ----- DOORS -----
const doors=[
    {x:400,y:1200,w:40,h:10,open:false}, // Bedroom
    {x:800,y:1200,w:40,h:10,open:false}, // Bathroom
    {x:1000,y:400,w:40,h:10,open:false}, // Basement
    {x:1800,y:50,w:40,h:10,open:false}  // Front Door escape
];

// ----- ROOMS -----
const rooms=[
    {x:100,y:1300,w:300,h:150,safe:true}, // Bedroom
    {x:700,y:1300,w:200,h:150,safe:true}, // Bathroom
    {x:900,y:100,w:300,h:300,safe:false}, // Basement
    {x:1200,y:1200,w:500,h:300,safe:false}, // Kitchen
    {x:1500,y:300,w:400,h:300,safe:false} // Backyard
];

// ----- STAIRS -----
const stairs=[
    {x:600,y:1200,w:50,h:50}, // to upstairs
];

// ----- FURNITURE -----
const furniture=[
    {x:1250,y:1250,w:100,h:50},
    {x:1350,y:1280,w:50,h:100},
    {x:1600,y:350,w:80,h:50}
];

// ----- KEYS -----
const houseKeys=[
    {x:150,y:1350,collected:false}, // Bedroom
    {x:750,y:1350,collected:false}, // Bathroom
    {x:950,y:200,collected:false},  // Basement
    {x:1600,y:350,collected:false}  // Backyard
];
const pickupDistance=25;

// ----- MONSTER -----
const monster={
    x:1800,y:1400,speed:1.2,ang:0,frame:0
};

// ----- GAME STATE -----
let gameOver=false;

// ----- UPDATE -----
function update(){
    if(gameOver) return;

    // Rotate player
    player.angle=Math.atan2(mouseY-canvas.height/2,mouseX-canvas.width/2);

    // Movement
    let speed=keys["shift"]?5:3;
    if(keys["w"]) player.y -= speed;
    if(keys["s"]) player.y += speed;
    if(keys["a"]) player.x -= speed;
    if(keys["d"]) player.x += speed;

    // Bounds
    if(player.x<0) player.x=0;
    if(player.y<0) player.y=0;
    if(player.x>world.w) player.x=world.w;
    if(player.y>world.h) player.y=world.h;

    // Safe zone check
    player.inSafeZone=false;
    rooms.forEach(r=>{
        if(player.x>r.x && player.x<r.x+r.w && player.y>r.y && player.y<r.y+r.h && r.safe){
            player.inSafeZone=true;
        }
    });

    // Monster movement
    const dist=Math.hypot(player.x-monster.x,player.y-monster.y);
    if(!player.inSafeZone){
        const a=Math.atan2(player.y-monster.y,player.x-monster.x);
        monster.x += Math.cos(a)*monster.speed;
        monster.y += Math.sin(a)*monster.speed;
        monster.ang=a;
        if(dist<300 && Math.random()<0.01) growl.play(); // random growl
        if(dist<30){
            player.health-=0.7;
        }
    }else{
        // retreat
        if(monster.x>0) monster.x-=monster.speed;
        if(monster.y>0) monster.y-=monster.speed;
    }

    // Pickup keys
    houseKeys.forEach(k=>{
        if(!k.collected && Math.hypot(player.x-k.x,player.y-k.y)<pickupDistance && keys["e"]){
            k.collected=true;
            player.keysCollected++;
        }
    });

    // Doors open/close
    doors.forEach(d=>{
        if(Math.hypot(player.x-(d.x+d.w/2),player.y-(d.y+d.h/2))<50 && keys["e"]){
            d.open=!d.open;
        }
    });

    // Escape
    const frontDoor=doors[3];
    if(player.keysCollected===houseKeys.length &&
       player.x>frontDoor.x && player.x<frontDoor.x+frontDoor.w &&
       player.y>frontDoor.y && player.y<frontDoor.y+frontDoor.h){
        alert("You escaped! You win!");
        window.location.reload();
    }

    // Death
    if(player.health<=0){
        gameOver=true;
        setTimeout(()=>{alert("You were caught by the monster! Game Over"); window.location.reload();},100);
    }

    // HUD
    document.getElementById("hp").textContent=Math.floor(player.health);
    document.getElementById("keys").textContent=player.keysCollected;
    document.getElementById("doors").textContent=doors.map(d=>d.open?"Open":"Closed").join(", ");
}

// ----- DRAW -----
function draw(){
    ctx.fillStyle="#111";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    const camX=player.x-canvas.width/2;
    const camY=player.y-canvas.height/2;

    // Rooms
    rooms.forEach(r=>{
        ctx.fillStyle=r.safe?"#0b3":"#444";
        ctx.fillRect(r.x-camX,r.y-camY,r.w,r.h);
    });

    // Furniture
    ctx.fillStyle="#654321";
    furniture.forEach(f=>ctx.fillRect(f.x-camX,f.y-camY,f.w,f.h));

    // Stairs
    ctx.fillStyle="#888";
    stairs.forEach(s=>ctx.fillRect(s.x-camX,s.y-camY,s.w,s.h));

    // Doors
    doors.forEach(d=>{
        ctx.fillStyle=d.open?"#0f0":"#f00";
        ctx.fillRect(d.x-camX,d.y-camY,d.w,d.h);
    });

    // Keys
    houseKeys.forEach(k=>{
        if(!k.collected){
            ctx.fillStyle="yellow";
            ctx.beginPath();
            ctx.arc(k.x-camX,k.y-camY,10,0,Math.PI*2);
            ctx.fill();
        }
    });

    // Monster
    ctx.save();
    ctx.translate(monster.x-camX,monster.y-camY);
    ctx.rotate(monster.ang);
    ctx.fillStyle="red";
    ctx.fillRect(-20,-20,40,40);
    ctx.restore();

    // Player
    ctx.save();
    ctx.translate(canvas.width/2,canvas.height/2);
    ctx.rotate(player.angle);
    ctx.fillStyle="#222"; ctx.fillRect(-10,-20,20,30); // hoodie
    ctx.fillStyle="#000"; ctx.fillRect(-10,10,20,15); // pants
    ctx.fillStyle="#000"; ctx.fillRect(-10,25,20,5); // shoes
    ctx.restore();
}

// ----- GAME LOOP -----
function loop(){update();draw();requestAnimationFrame(loop);}
loop();
</script>
</body>
</html>
