<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Forest Escape Survival</title>
<style>
body { margin:0; overflow:hidden; background:#0a1f0a; }
canvas { display:block; }
#hud {
    position:fixed; top:10px; left:10px;
    color:white; font-family:Arial;
    background:rgba(0,0,0,0.6); padding:10px;
}
</style>
</head>
<body>
<div id="hud">
‚ù§Ô∏è Health: <span id="hp">100</span><br>
üïπÔ∏è Grapple: <span id="grapple">0</span>/5
</div>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

// WORLD
const world = { w: 5000, h: 2000 };

// PLAYER
const player = {
    x: 100, y: 1800,
    angle: 0,
    speed: 3,
    health: 100,
    grappleCount: 0,
    isGrappled: false,
    checkpoint: {x:100, y:1800}
};

// INPUT
const keys = {};
addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

let mouseX = 0, mouseY = 0;
addEventListener("mousemove", e => {
    mouseX = e.clientX;
    mouseY = e.clientY;
});

// Grapple
addEventListener("keydown", e => {
    if(e.key.toLowerCase() === "f" && player.isGrappled){
        player.grappleCount++;
        if(player.grappleCount>=5){
            player.isGrappled=false;
            player.grappleCount=0;
        }
    }
});

// TREES
const trees = [];
for(let i=0;i<200;i++){
    trees.push({
        x: Math.random()*world.w,
        y: Math.random()*world.h
    });
}

// MONSTERS
const monsters = [];
for(let i=0;i<6;i++){
    monsters.push({
        x: Math.random()*world.w,
        y: Math.random()*world.h,
        speed: 1.5
    });
}

// BULLETS
const bullets = [];
addEventListener("mousedown", () => {
    if(!player.isGrappled){
        bullets.push({
            x: player.x,
            y: player.y,
            a: player.angle,
            s: 12
        });
    }
});

function update(){
    // Aim
    player.angle = Math.atan2(
        mouseY - canvas.height*0.65,
        mouseX - canvas.width/2
    );

    if(!player.isGrappled){
        let speed = keys["shift"] ? 5 : 3;
        if(keys["w"]){ player.x += Math.cos(player.angle)*speed; player.y += Math.sin(player.angle)*speed; }
        if(keys["s"]){ player.x -= Math.cos(player.angle)*speed; player.y -= Math.sin(player.angle)*speed; }
        if(keys["a"]){ player.x += Math.cos(player.angle-Math.PI/2)*speed; player.y += Math.sin(player.angle-Math.PI/2)*speed; }
        if(keys["d"]){ player.x += Math.cos(player.angle+Math.PI/2)*speed; player.y += Math.sin(player.angle+Math.PI/2)*speed; }
    }

    // Bullets
    bullets.forEach((b,i)=>{
        b.x += Math.cos(b.a)*b.s;
        b.y += Math.sin(b.a)*b.s;

        monsters.forEach((m,mi)=>{
            if(Math.hypot(b.x-m.x,b.y-m.y)<25){
                monsters.splice(mi,1);
                bullets.splice(i,1);
            }
        });
    });

    // Monsters chase
    monsters.forEach(m=>{
        if(!player.isGrappled){
            const dist = Math.hypot(player.x-m.x,player.y-m.y);
            if(dist<200){
                const a = Math.atan2(player.y-m.y,player.x-m.x);
                m.x += Math.cos(a)*m.speed;
                m.y += Math.sin(a)*m.speed;
            }
            if(dist<25 && !player.isGrappled){
                player.isGrappled=true;
                player.grappleCount=0;
            }
        }
    });

    // Health / respawn
    if(player.health<=0){
        player.x = player.checkpoint.x;
        player.y = player.checkpoint.y;
        player.health = 100;
    }

    document.getElementById("hp").textContent=Math.floor(player.health);
    document.getElementById("grapple").textContent=player.grappleCount;
}

function draw(){
    const camX = player.x - canvas.width/2;
    const camY = player.y - canvas.height*0.65;

    // Ground
    ctx.fillStyle="#0a1f0a";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // Trees
    ctx.fillStyle="#064006";
    trees.forEach(t=>{
        ctx.beginPath();
        ctx.arc(t.x-camX, t.y-camY, 20,0,Math.PI*2);
        ctx.fill();
    });

    // Monsters
    ctx.fillStyle="red";
    monsters.forEach(m=>{
        ctx.beginPath();
        ctx.arc(m.x-camX, m.y-camY, 20,0,Math.PI*2);
        ctx.fill();
    });

    // Bullets
    ctx.fillStyle="yellow";
    bullets.forEach(b=>{
        ctx.fillRect(b.x-camX,b.y-camY,4,4);
    });

    // Player
    ctx.save();
    ctx.translate(canvas.width/2, canvas.height*0.65);
    ctx.rotate(player.angle);
    ctx.fillStyle="#ddd";
    ctx.fillRect(-10,-20,20,30); // body
    ctx.fillStyle="#999";
    ctx.fillRect(10,-5,20,6); // rifle
    ctx.restore();
}

function loop(){
    update();
    draw();
    requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
